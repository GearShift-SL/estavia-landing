---
import { getCollection } from 'astro:content';
import PageLayout from '@/layouts/PageLayout.astro';
import PostsByCategory from '@/components/blog/PostsByCategory.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
  });

  // Get unique categories from all posts
  const categories = [...new Set(posts.map((post) => post.data.category.toLowerCase()))];

  // Generate paths for each category
  const paths = categories.map((category) => {
    return {
      params: { category: category.toLowerCase() },
      props: { posts: posts.filter((post) => post.data.category.toLowerCase() === category) },
    };
  });

  return paths;
}

const { category } = Astro.params;
const { posts } = Astro.props;

// Create metadata for the page
const metadata = {
  title: `Publicaciones en la categoría: ${category}`,
  description: `Explora todas las publicaciones de Estavia, el agente inmobiliario de IA, en la categoría: ${category}. Consejos, novedades y recursos útiles.`,
};
---

<PageLayout metadata={metadata}>
  <div class="max-w-3xl mx-auto px-4 py-16">
    <PostsByCategory posts={posts} category={category} />
  </div>
</PageLayout>
